- name: Deploy Sealed Secrets Controller
  hosts: localhost
  connection: local
  gather_facts: false

  pre_tasks:
    - name: Ensure required environment variables
      ansible.builtin.assert:
        that:
          - lookup('env', 'KUBECONFIG') != ''
        fail_msg: "KUBECONFIG environment variable must be set"

  tasks:
    - name: Install Sealed Secrets Controller
      kubernetes.core.helm:
        name: sealed-secrets
        chart_ref: sealed-secrets
        chart_repo_url: https://charts.bitnami.com/bitnami
        chart_version: 2.18.0
        release_namespace: kube-system
        wait: true
        timeout: 5m
